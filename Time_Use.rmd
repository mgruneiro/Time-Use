---
title: "How likely are you to have a social life?"
subtitle: "SDS 390 Final Project"
author: "Madison Gruneiro, Truc Tran"
date: "12/3/2020"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ipumsr)
library(tidyverse)
library(bayesrules)
library(bayesplot)
library(rstanarm)
library(naniar)
```

## Introduction

We want to predict how much time an individual spends socializing/relaxing and for personal care based on   
- Number of children  
- Hours worked per week    
- Weekly earnings   
- Age  
- Sex 

## Loading in Ipums data

```{r, results='hide'}
ddi <- read_ipums_ddi("atus_00001.xml")
data <- read_ipums_micro(ddi)
```
### Sorting data

```{r}
data_2019 <- data %>%
  filter(YEAR == "2019")%>%
  replace_with_na(replace = list(UHRSWORKT=c(9999, 9995)))%>%
  replace_with_na(replace = list(EARNWEEK = 99999.99)) %>%
  na.omit()
```

This returns a data frame with 4,847 observations to work with.

## About the data

The data we are using is from Ipums Time Use data. We selected data collected from surveys conducted on Americans from years 2015 to 2019. For our model, we used data from only 2019. The Bureau of Labor Statistics compiled a questionnaire with the goal of measuring how people spend time on different life activities. The data collection started in 2003 with some years having special modules, such as the eating and health module from 2006 to 2008 and from 2014 to 2016. The survey respondents provide information about how they spend their time in a 24-hour period. Survey respondents are randomly selected from the participants in the Current Population Survey (CPS). Respondents over the age of 15 completed a one-day time diary. The days of the distribution of the time diary are: 10% allocation to each day of the week (Monday through Friday), 25% to Saturday, and 25% to Sunday. Each respondent were offered an incentive of $40 for participation.

## Method

## Variables

### ACT_SOCIAL: Minutes spent socializing/relaxing per week

Summary Stats

```{r}
summary(data_2019$ACT_SOCIAL)
hist(data_2019$ACT_SOCIAL)
```


## Building model for socializing/relaxing

```{r, results='hide'}
set.seed(84735)
social_model1 <- stan_glm(ACT_SOCIAL ~ UHRSWORKT + HH_NUMOWNKIDS + EARNWEEK, 
                             data = data_2019,
                             family = gaussian,
                             chains = 4,
                             iter = 1000*2)
```
Can add more to this model.

### Diagnostics

```{r}
mcmc_trace(social_model1)
mcmc_dens_overlay(social_model1)
```

The trace plots appear stable and the densities of the chains are similar so the approximations of the posterior should also be stable. There is a discrepancy in the number of children under 18 variable. Two chains are not peaking as high as the other chains but they follow the general shape of the other distributions so we accept this as sufficient. This provides evidence that our simulation is stable and our chains are sufficiently long. 

### Posterior Predictive Check

```{r}
set.seed(84735)
pp_check(social_model1, nreps = 50)
```

The model captures somewhat of observed values for time spent socializing/relaxing but it doesn't pick up the average values in the data.   

### Looking at predictions

```{r}
set.seed(84735)
predictions <- posterior_predict(social_model1, newdata = data_2019)

prediction_summary(y = data_2019$ACT_SOCIAL, yrep = predictions)
```



### Analysis

## Model for personal care

```{r, results="hide"}
set.seed(84735)
care_model1 <- stan_glm(ACT_PCARE ~ AGE + HH_NUMOWNKIDS +UHRSWORKT + EARNWEEK, 
                             data = data_2019,
                             family = gaussian,
                             chains = 4,
                             iter = 1000*2)
```

### Diagnostics

```{r}
mcmc_trace(care_model1)
mcmc_dens_overlay(care_model1)
```

### Posterior Predictive Check

```{r}
set.seed(84735)
pp_check(care_model1, nreps = 50)
```


## References

Sandra L. Hofferth, Sarah M. Flood, Matthew Sobek and Daniel Backman. American Time Use Survey Data Extract Builder: Version 2.8 [dataset]. College Park, MD: University of Maryland and Minneapolis, MN: IPUMS, 2020.
[https://doi.org/10.18128/D060.V2.8](https://doi.org/10.18128/D060.V2.8) 

IPUMS ATUS, University of Minnesota, [www.ipums.org](www.ipums.org)
